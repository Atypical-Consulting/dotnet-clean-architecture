apiVersion: v1
kind: Secret
metadata:
  name: {{ include "clean-architecture.fullname" . }}-secrets
  namespace: {{ .Values.namespace }}
  labels:
    {{- include "clean-architecture.labels" . | nindent 4 }}
  annotations:
    # When using an external secret manager (e.g., External Secrets Operator,
    # Sealed Secrets, or Vault), replace this Secret resource with the
    # appropriate ExternalSecret or SealedSecret resource.
    helm.sh/hook: pre-install,pre-upgrade
type: Opaque
data:
  {{- if .Values.postgresql.password }}
  POSTGRES_PASSWORD: {{ .Values.postgresql.password | b64enc | quote }}
  {{- else }}
  # Password must be provided via --set postgresql.password=... or an external secret manager.
  # This placeholder will cause authentication failures if not overridden.
  POSTGRES_PASSWORD: {{ "" | b64enc | quote }}
  {{- end }}
